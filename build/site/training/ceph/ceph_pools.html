<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Configuring your cluster Pools :: Ceph Top Gun Enablement</title>
    <link rel="canonical" href="https://likid0.github.io/ceph-top-gun-enablement/training/ceph/ceph_pools.html">
    <meta name="generator" content="Antora 3.0.1">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.ceph.com/en/latest/" target="_blank">
          <img src="../../_/img/header_logo_reverse.svg" height="48px" alt="Ceph">
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Get Help</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://access.redhat.com/documentation/en-us/red_hat_openshift_container_storage" target="_blank">Ceph Documentation</a>
            <a class="navbar-item" href="https://bugzilla.redhat.com/describecomponents.cgi?product=Red%20Hat%20OpenShift%20Container%20Storage" target="_blank">Browse Bugs</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Improve Guides</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://github.com/red-hat-storage/ocs-training/issues/new/choose" target="_blank">Open Issue</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Infos</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://www.redhat.com/en/blog/channel/red-hat-storage" target="_blank">Our Blog</a>
            <a class="navbar-item" href="https://www.youtube.com/channel/UCoyG8VyvB-XUxQl1mD3T3Gw" target="_blank">Youtube</a>
            <a class="navbar-item" href="https://docs.ceph.com/en/latest/" target="_blank">OCS Technology</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="training" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Ceph Top-Gun Enablement</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Ceph Lab Setup</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="opentlc_lab_env.html">Opentlc Lab Env</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Core Ceph</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_introduction.html">Ceph Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_architecture.html">Ceph Architecture</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_cluster_partitioning.html">Ceph Cluster Partitioning</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_hardware.html">Ceph Hardware Recommendations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_deployment_intro.html">Ceph Install Methods </a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_cephadm_intro.html">Cephadm Orchestrator</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_deploy_basic.html">Deploy Ceph with Cephadm</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_cli_intro.html">Ceph CLI basic commands</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="ceph_pools.html">Ceph storage pools config</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_bluestore.html">Ceph OSD Bluestore</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_recovery.html">Ceph OSD Failure/Recovery</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph-upgrades_cephadm.html">Upgrade Ceph with Cephadm</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Ceph RADOS Block Device</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cephrbd_intro.html">RADOS Block Device introduction</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">CephFS Shared FileSystem</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cephfs_intro.html">CephFS introduction &amp; Deployment</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cephfs_advanced.html">CephFS Deep Dive</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Ceph RadosGW</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_intro.html">RGW Introduction &amp; Deployment</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_arch_deep_dive.html">RGW Deep Dive</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_ha.html">RGW High Availability</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_ssl.html">RGW &amp; Ingress with SSL</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_users_quotas.html">RGW Users &amp; Quotas</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_auth.html">RGW Auth &amp; Authz</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_object_versioning.html">RGW S3 Object Versioning</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_placement_and_storage_classes.html">RGW Placement &amp; Storage Classes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_life_cycle_management.html">RGW Life Cycle Management</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_bucket_policy.html">RGW S3 Bucket Policy</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_sts_introduction.html">RGW Secure Token Service</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_sts_bucket_role_policy.html">RGW Bucket vs Role Policy</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_multisite.html">RGW Multisite Replication</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_cloudsync.html">RGW Object Cloud Transition</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_presignedurl.html">RGW presigned URL</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_opslog.html">RGW Opslog</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_bucket_notification.html">RGW bucket Notification</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Ceph Troubleshooting</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="trouble-shooting-nearfull-osds.html">Troubleshooting nearfull OSDs</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="troubleshooting_bluestore.html">Troubleshooting Bluestore issues</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Ceph Benchmarking</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_performance_example.html">Setting the Inital Baseline</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Ceph Stretched</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="rhcs-stretched-deploy.html">Ceph Stretch Mode</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Ceph Top-Gun Enablement</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Ceph Top-Gun Enablement</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Ceph Top-Gun Enablement</a></li>
    <li>Core Ceph</li>
    <li><a href="ceph_pools.html">Ceph storage pools config</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///antora/training/modules/ceph/pages/ceph_pools.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Configuring your cluster Pools</h1>
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter is here to provide you with the basic knowledge when it comes to configuring
your Ceph cluster.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ceph_storage_pools"><a class="anchor" href="#_ceph_storage_pools"></a>2. Ceph storage pools</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Pools are logical partitions of the Ceph cluster which store objects. Pools have specific attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <em>pool type</em>, which determines the data protection mechanism used by the pool. It can be <em>Replicated</em>
or <em>Erasure Coding</em>. The Replication type distributes multiple copies of each object across the cluster.
The Erasure Coding type splits each object into chunks and calculate parity chunks and distributes
them across OSDs</p>
</li>
<li>
<p>The number of <em>Placement Groups</em> (<code>PGs</code>) for the pool</p>
</li>
<li>
<p>A <em>CRUSH</em> (<strong>Controlled Replication Under Scalable Hashing</strong>) to determine how the <code>PGs</code> for the pool
will be mapped to OSDs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When Ceph stores an object, it assigns the object to one and only one <code>PG</code> within a pool. The <code>PG</code> is mapped
to a set of OSDs according to the <code>CRUSH</code> rule assigned to the pool. The cluster administrator can assign
one and only one <code>CRUSH</code> rule to a pool.</p>
</div>
<div class="paragraph">
<p>The number of PGs assigned to a pool has an impoact on the performance that can be delivered by a pool. The
best practice is to assign each OSD in the cluster between 100 and 200 <code>PGs</code>. If all the pools in the cluster
share the same OSDs it means that the total number of <code>PGs</code> in the cluster that will result in each OSD
managing the correct numebr of <code>PGs</code> will have to be split across all the pools configured in the cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, upon pool creation, a Ceph safety checks is in place to make sure each OSD will not
be assigned more than 200 <code>PGs</code>. If this boundary is crossed the pool creation fails.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_replicated_pools"><a class="anchor" href="#_replicated_pools"></a>3. Replicated pools</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The storage administrator can create a pool using the following command:<br>
<code>ceph osd pool create {pool_name} {pg_num}</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>{pool_name}</code> is the name of the pool</p>
</li>
<li>
<p><code>{pg_num}</code> is the number of <code>PGs</code> you want to assign to the pool</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When you create a pool the <code>size</code> and <code>min_size</code> parameters will be automatically assigend to the
pool following the <code>osd_pool_default_size</code> and <code>osd_pool_default_min_size</code> parameters.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Starting with Luminous, each pool is assigned a label to identify the application or the type of data
rthat will be stored in the pool. This label can be any character string and the following are used
for the most common use cases of a Ceph cluster:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cephfs</code> for pools used by a Ceph FileSystem (CephFS)</p>
</li>
<li>
<p><code>rbd</code> for pools used for Ceph RBDs</p>
</li>
<li>
<p><code>rgw</code> for pools used by a RADOS Gateway</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can assign the application label using the following command:<br>
<code>ceph osd pool application enable {pool_name} {application}</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exercise_replicated_pools"><a class="anchor" href="#_exercise_replicated_pools"></a>4. Exercise - Replicated pools</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">Create a repluicated pool</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">[root@ceph00 ]# ceph osd pool create testpool 16
<em>pool 'testpool' created</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">List pools in your cluster</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">[root@ceph00 ]# <strong>ceph osd lspools</strong>
<em>1 device_health_metrics
2 testpool</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">List pools in your cluster another way</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">[root@ceph00 ]# <strong>ceph osd pool ls</strong>
<em>device_health_metrics
testpool</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Detailed list of pools in your cluster</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">[root@ceph00 ]# <strong>ceph osd pool ls detail</strong>
<em>pool 1 'device_health_metrics' replicated size 2 min_size 1 crush_rule 0 object_hash rjenkins pg_num 1 pgp_num 1 autoscale_mode on last_change 41 flags hashpspool stripe_width 0 pg_num_min 1 application mgr_devicehealth
pool 2 'testpool' replicated size 2 min_size 1 crush_rule 0 object_hash rjenkins pg_num 16 pgp_num 16 autoscale_mode on last_change 45 flags hashpspool stripe_width 0</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Assign an application to the pool</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">[root@ceph00 ]# <strong>ceph osd pool application enable testpool myapp</strong>
<em>enabled application 'myapp' on pool 'testpool'</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Detailed space usage per pool</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">[root@ceph00 ]# <strong>ceph df</strong>
<em>--- RAW STORAGE ---
CLASS  SIZE     AVAIL    USED    RAW USED  %RAW USED
hdd    1.1 TiB  1.1 TiB  52 MiB   9.1 GiB       0.79
TOTAL  1.1 TiB  1.1 TiB  52 MiB   9.1 GiB       0.79

--- POOLS ---
POOL                   ID  PGS  STORED  OBJECTS  USED  %USED  MAX AVAIL
device_health_metrics   1    1     0 B        0   0 B      0    543 GiB
testpool                2   16     0 B        0   0 B      0    543 GiB</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Pool access statistics</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">[root@ceph00 ]# <strong>ceph osd pool stats</strong>
<em>pool device_health_metrics id 1
  nothing is going on

pool testpool id 2
  nothing is going on</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Rename a pool</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">[root@ceph00 ]# <strong>ceph osd pool rename testpool newpool</strong>
<em>pool 'testpool' renamed to 'newpool'</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Changing pool parameters</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"><em>[root@ceph00 ]# ceph osd pool set newpool size 3
set pool 2 size to 3
[root@ceph00 ]# ceph osd pool set newpool min_size 2
set pool 2 min_size to 2</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Checking pool parameters</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">[root@ceph00 ]# <strong>ceph osd pool get newpool all</strong>
<em>size: 3
min_size: 2
pg_num: 16
pgp_num: 16
crush_rule: replicated_rule
hashpspool: true
nodelete: false
nopgchange: false
nosizechange: false
write_fadvise_dontneed: false
noscrub: false
nodeep-scrub: false
use_gmt_hitset: 1
fast_read: 0
pg_autoscale_mode: on</em></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>get all</code> command has not been updated to display all parameters on a pool. To view
all parameters use <code>ceph osd pool ls detail</code>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Checking a single pool parameter</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">[root@ceph00 ]# <strong>ceph osd pool get newpool size</strong>
<em>size: 3</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Delete a pool</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">[root@ceph00 ]# <strong>ceph osd pool delete newpool</strong>
<em>Error EPERM: WARNING: this will <strong>PERMANENTLY DESTROY</strong> all data stored in pool newpool.  If you are <strong>ABSOLUTELY CERTAIN</strong> that is what you want, pass the pool name <strong>twice</strong>, followed by --yes-i-really-really-mean-it.</em>
[root@ceph00 ]# <strong>ceph osd pool delete newpool newpool --yes-i-really-really-mean-it</strong>
<em>pool 'newpool' removed</em></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Once a pool is deleted the data for this pool can not be recovered as all the <code>PGs</code> will
be removed from the cluster immediately.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This command requires that you enter the name of the pool twice followed by the special
<code>--yes-i-really-really-mean-it</code> flag. Failing to do so will result in the command doing nothing.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Uploading data to a pool</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">[root@ceph00 ]# <strong>ceph osd pool create radospool 16</strong>
<em>pool 'radospool' created</em>
[root@ceph00 ]# <strong>rados -p radospool put nons /etc/services</strong>
[root@ceph00 ]# <strong>rados -p radospool put -N system withns /etc/services</strong>
[root@ceph00 ]# <strong>rados -p radospool ls --all</strong>
<em>system	withns
	nons</em>
[root@ceph00 ]# <strong>rados -p radospool ls --all -f json-pretty</strong>
<em>[
    {
        "namespace": "system",
        "name": "withns"
    },
    {
        "namespace": "",
        "name": "nons"
    }
]</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Delete a pool</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">[root@ceph00 ]# <strong>ceph osd pool delete radospool radospool --yes-i-really-really-mean-it</strong>
<em>pool 'radospool' removed</em></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_erasure_coded_pools"><a class="anchor" href="#_erasure_coded_pools"></a>5. Erasure Coded pools</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Erasure coded pools use erasure coding instead of replication to protect object data.  The object is
divided into a number of data chunks, and the data chunks are stored in separate OSDs. In addition,
a number of coding chunks are calculated based on the data chunks, and are also stored in different
OSDs. Erasure coding mechanism will enable the rebuild of the data using surviving chunks in the same
way RAID-5 or RAID-6 do.</p>
</div>
<div class="paragraph">
<p>Erasure coded pools obey the following logic:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Data is divided into <code>k</code> data chunks</p>
</li>
<li>
<p><code>m</code> coding chunks are calculated
Chunks are written to disk using <code>k + m</code> OSDs</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All chunks, data or parity, are the same size.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exercise_erasure_coded_pools"><a class="anchor" href="#_exercise_erasure_coded_pools"></a>6. Exercise - Erasure coded pools</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">Create an Erasure code profile</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">[root@ceph00 ]# <strong>ceph osd erasure-code-profile set myprofile k=2 m=1</strong>
[root@ceph00 ]# <strong>ceph osd erasure-code-profile ls</strong>
<em>default
myprofile</em>
[root@ceph00 ]# <strong>ceph osd erasure-code-profile get myprofile</strong>
<em>crush-device-class=
crush-failure-domain=host
crush-root=default
jerasure-per-chunk-alignment=false
k=2
m=1
plugin=jerasure
technique=reed_sol_van
w=8</em></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When the failure domain is not specified for a profile the default is <code>host</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Once a pool has been created using an Erasure Code profile you can not change the parameters
of the Erasure Code profile.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Modify the Erasure Code profile</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">[root@ceph00 ]# <strong>ceph osd erasure-code-profile set myprofile k=3 m=2 \
                                                      crush-failure-domain=osd --force</strong>
[root@ceph00 ]# <strong>ceph osd erasure-code-profile get myprofile</strong>
<em>crush-device-class=
crush-failure-domain=<strong>osd</strong>
crush-root=default
jerasure-per-chunk-alignment=false
k=<strong>3</strong>
m=<strong>2</strong>
plugin=jerasure
technique=reed_sol_van
w=8</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Create a pool using the Erasure Code profile</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">[root@ceph00 ]# <strong>ceph osd pool create ecpool 16 16 erasure myprofile</strong>
<em>pool 'ecpool' created</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Verify all PGs are active+clean</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">[root@ceph00 ]# <strong>ceph pg stat</strong>
<em>33 pgs: 33 active+clean; 1.3 MiB data, 74 MiB used, 1.1 TiB / 1.1 TiB avail</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Assign the pool an application</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">[root@ceph00 ]# <strong>ceph osd pool application enable ecpool rgw</strong>
<em>enabled application 'rgw' on pool 'ecpool'</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Verify space for existing pools</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">[root@ceph00 ]# <strong>ceph df</strong>
<em>--- RAW STORAGE ---
CLASS  SIZE     AVAIL    USED    RAW USED  %RAW USED
hdd    1.1 TiB  1.1 TiB  73 MiB   9.1 GiB       0.79
TOTAL  1.1 TiB  1.1 TiB  73 MiB   9.1 GiB       0.79

--- POOLS ---
POOL                   ID  PGS  STORED  OBJECTS  USED  %USED  MAX AVAIL
device_health_metrics   1    1     0 B        0   0 B      0    543 GiB
ecpool                  4   16     0 B        0   0 B      0    651 GiB</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Verify the pool parameters</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">[root@ceph00 ]# <strong>ceph osd pool ls detail</strong>
<em>pool 1 'device_health_metrics' replicated size 2 min_size 1 crush_rule 0 object_hash rjenkins pg_num 1 pgp_num 1 autoscale_mode on last_change 41 flags hashpspool stripe_width 0 pg_num_min 1 application mgr_devicehealth
pool 4 'ecpool' erasure profile myprofile size 5 min_size 4 crush_rule 1 object_hash rjenkins pg_num 16 pgp_num 16 autoscale_mode on last_change 61 flags hashpspool stripe_width 12288 application rgw</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Upload an object and verify EC pool usage</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">[root@ceph00 ]# <strong>rados -p ecpool put mytestvi /usr/bin/vi</strong>
[root@ceph00 ]# <strong>ceph df</strong>
<em>--- RAW STORAGE ---
CLASS  SIZE     AVAIL    USED    RAW USED  %RAW USED
hdd    1.1 TiB  1.1 TiB  75 MiB   9.1 GiB       0.79
TOTAL  1.1 TiB  1.1 TiB  75 MiB   9.1 GiB       0.79

--- POOLS ---
POOL                   ID  PGS  STORED   OBJECTS  USED     %USED  MAX AVAIL
device_health_metrics   1    1      0 B        0      0 B      0    543 GiB
ecpool                  4   16  1.1 MiB        1  2.2 MiB      0    651 GiB</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Retrive file and compare with original</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">[root@ceph00 ]# <strong>rados -p ecpool get mytestvi /tmp/vi</strong>
[root@ceph00 ]# <strong>diff /usr/bin/vi /tmp/vi</strong></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The diff command produces no output indicating the files are identical.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Cleanup</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">[root@ceph00 ]# <strong>ceph osd pool delete ecpool ecpool \
                                       --yes-i-really-really-mean-it</strong>
<em>pool 'ecpool' removed</em>
[root@ceph00 ]# <strong>ceph osd erasure-code-profile rm myprofile</strong></code></pre>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <a class="navbar-item" href="https://www.redhat.com/en/technologies/cloud-computing/openshift-container-storage" target="_blank">
      <img src="../../_/img/header_logo.svg" alt="Ceph">
  </a>
</footer>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
