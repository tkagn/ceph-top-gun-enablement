<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RadosGW users and Quotas :: Ceph Top Gun Enablement</title>
    <link rel="canonical" href="https://likid0.github.io/ceph-top-gun-enablement/training/ceph/radosgw_users_quotas.html">
    <meta name="generator" content="Antora 3.0.1">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.ceph.com/en/latest/" target="_blank">
          <img src="../../_/img/header_logo_reverse.svg" height="48px" alt="Ceph">
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Get Help</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://access.redhat.com/documentation/zh-cn/red_hat_ceph_storage/5" target="_blank">Ceph Documentation</a>
            <a class="navbar-item" href="https://bugzilla.redhat.com/describecomponents.cgi?product=Red%20Hat%20OpenShift%20Container%20Storage" target="_blank">Browse Bugs</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Improve Guides</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://github.com/likid0/ceph-top-gun-enablement/issues/new/choose" target="_blank">Open Issue</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Infos</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://www.redhat.com/en/blog/channel/red-hat-storage" target="_blank">Our Blog</a>
            <a class="navbar-item" href="https://www.youtube.com/channel/UCoyG8VyvB-XUxQl1mD3T3Gw" target="_blank">Youtube</a>
            <a class="navbar-item" href="https://docs.ceph.com/en/latest/" target="_blank">Ceph Storage Technology</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="training" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Ceph Top-Gun Enablement</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Ceph Lab Setup</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="opentlc_lab_env.html">Opentlc Lab Env</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Core Ceph</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_introduction.html">Ceph Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_architecture.html">Ceph Architecture</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_cluster_partitioning.html">Ceph Cluster Partitioning</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_hardware.html">Ceph Hardware Recommendations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_deployment_intro.html">Ceph Install Methods </a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_cephadm_intro.html">Cephadm Orchestrator</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_deploy_basic.html">Deploy Ceph with Cephadm</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_cli_intro.html">Ceph CLI basic commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_pools.html">Ceph storage pools config</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_bluestore.html">Ceph OSD Bluestore</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_recovery.html">Ceph OSD Failure/Recovery</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph-upgrades_cephadm.html">Upgrade Ceph with Cephadm</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_deployment_challenge.html">Challenge Ceph Deployment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Ceph RADOS Block Device</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cephrbd_intro.html">RADOS Block Device introduction</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">CephFS Shared FileSystem</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cephfs_intro.html">CephFS introduction &amp; Deployment</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cephfs_advanced.html">CephFS Deep Dive</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_cephfs_challenge.html">Challenge Cephfs</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Ceph RadosGW</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_intro.html">RGW Introduction &amp; Deployment</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_arch_deep_dive.html">RGW Deep Dive</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_ha.html">RGW High Availability</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_ssl.html">RGW &amp; Ingress with SSL</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="radosgw_users_quotas.html">RGW Users &amp; Quotas</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_auth.html">RGW Auth &amp; Authz</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_object_versioning.html">RGW S3 Object Versioning</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_placement_and_storage_classes.html">RGW Placement &amp; Storage Classes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_life_cycle_management.html">RGW Life Cycle Management</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_bucket_policy.html">RGW S3 Bucket Policy</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_sts_introduction.html">RGW Secure Token Service</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_sts_bucket_role_policy.html">RGW Bucket vs Role Policy</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_multisite.html">RGW Multisite Replication</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_cloudsync.html">RGW Object Cloud Transition</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_presignedurl.html">RGW presigned URL</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_opslog.html">RGW Opslog</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_bucket_notification.html">RGW bucket Notification</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Ceph Troubleshooting</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="trouble-shooting-nearfull-osds.html">Troubleshooting nearfull OSDs</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="troubleshooting_bluestore.html">Troubleshooting Bluestore issues</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="trouble-shooting-large-omap-objects.html">Troubleshooting Large Omap Objects</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Ceph Benchmarking</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_performance_example.html">Setting the Inital Baseline</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Ceph Stretched</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="rhcs-stretched-deploy.html">Ceph Stretch Mode</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Ceph Top-Gun Enablement</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Ceph Top-Gun Enablement</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Ceph Top-Gun Enablement</a></li>
    <li>Ceph RadosGW</li>
    <li><a href="radosgw_users_quotas.html">RGW Users &amp; Quotas</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///antora/training/modules/ceph/pages/radosgw_users_quotas.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">RadosGW users and Quotas</h1>
<div class="sect1">
<h2 id="_radosgw_users"><a class="anchor" href="#_radosgw_users"></a>1. RadosGW Users</h2>
<div class="sectionbody">
<div class="paragraph">
<p>User management is performed differently from traditional user management in Ceph clusters (cephx)</p>
</div>
<div class="paragraph">
<p>Two user types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>User: reflects a user of the S3 interface</p>
</li>
<li>
<p>Subuser: reflects a user of the Swift interface. A sub-user is associated with a user</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Swift users are out of the scope of this workshop
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When creating RADOS Gateway users, both the --uid and --display-name options are required and specify a unique account name and a human-friendly display name. Use the&#8201;&#8212;&#8201;access-key and --secret options to specify a custom AWS account and secret key for the RADOS user.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># radosgw-admin user create --uid='user2' --display-name='Second User' --access-key='S3user2' --secret-key='S3user2key'
{
    "user_id": "user2",
    "display_name": "Second User",
    "email": "",
    "suspended": 0,
    "max_buckets": 1000,
    "auid": 0,
    "subusers": [],
    "keys": [
        {
            "user": "user2",
            "access_key": "S3user2",
            "secret_key": "S3user2key"
        }
    ],
    "swift_keys": [],
    "caps": [],
    "op_mask": "read, write, delete",
    "default_placement": "",
    "placement_tags": [],
    "bucket_quota": {
        "enabled": false,
        "check_on_raw": false,
        "max_size": -1,
        "max_size_kb": 0,
        "max_objects": -1
    },
    "user_quota": {
        "enabled": false,
        "check_on_raw": false,
        "max_size": -1,
        "max_size_kb": 0,
        "max_objects": -1
    },
    "temp_url_keys": [],
    "type": "rgw"
}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the access key and secret key are not specified, the radosgw-admin command automatically generates them and displays them in the output.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Each S3 user is defined by an access key and a secret key</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can check user info, and usage stats with the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># radosgw-admin user stats --uid='user2'
{
    "stats": {
        "size": 5320,
        "size_actual": 16384,
        "size_kb": 6,
        "size_kb_actual": 16,
        "num_objects": 4
    },
    "last_stats_sync": "0.000000",
    "last_stats_update": "2022-12-22T08:11:11.681735Z"
}

# radosgw-admin usage show --show-log-entries=false
# radosgw-admin user info --uid='user2'</pre>
</div>
</div>
<div class="paragraph">
<p>To regenerate only the secret key of an existing user, use the radosgw-admin key create command with the --gen-secret option.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># radosgw-admin key create  --uid='user2' --access-key='S3user2' --gen-secret
{
    "user_id": "user2",
    "display_name": "Second User",
    "email": "",
    "suspended": 0,
    "max_buckets": 1000,
    "subusers": [],
    "keys": [
        {
            "user": "user2",
            "access_key": "S3user2",
            "secret_key": "S3SECRETKEY"
        }
    ],
    "swift_keys": [],
    "caps": [],
    "op_mask": "read, write, delete",
    "default_placement": "",
    "default_storage_class": "",
    "placement_tags": [],
    "bucket_quota": {
        "enabled": false,
        "check_on_raw": false,
        "max_size": -1,
        "max_size_kb": 0,
        "max_objects": -1
    },
    "user_quota": {
        "enabled": false,
        "check_on_raw": false,
        "max_size": -1,
        "max_size_kb": 0,
        "max_objects": -1
    },
    "temp_url_keys": [],
    "type": "rgw",
    "mfa_ids": []
}</pre>
</div>
</div>
<div class="paragraph">
<p>You can have more that one Access key/Secret Key pair for a user, this allows
for key rotation without any service disruption, let&#8217;s say we need to rotate
the keys for user2, we can add a new key pair</p>
</div>
<div class="listingblock">
<div class="content">
<pre># radosgw-admin key create  --uid='user2' --gen-access-key
{
    "user_id": "user2",
    "display_name": "Second User",
    "email": "",
    "suspended": 0,
    "max_buckets": 1000,
    "subusers": [],
    "keys": [
        {
            "user": "user2",
            "access_key": "B7WGSZ1PMMA4RHHVMWK5",
            "secret_key": "S3SECRETKEYNEW"
        },
        {
            "user": "user2",
            "access_key": "S3user2",
            "secret_key": "S3SECRETKEY"
        }
    ],
    "swift_keys": [],
    "caps": [],
    "op_mask": "read, write, delete",
    "default_placement": "",
    "default_storage_class": "",
    "placement_tags": [],
    "bucket_quota": {
        "enabled": false,
        "check_on_raw": false,
        "max_size": -1,
        "max_size_kb": 0,
        "max_objects": -1
    },
    "user_quota": {
        "enabled": false,
        "check_on_raw": false,
        "max_size": -1,
        "max_size_kb": 0,
        "max_objects": -1
    },
    "temp_url_keys": [],
    "type": "rgw",
    "mfa_ids": []
}</pre>
</div>
</div>
<div class="paragraph">
<p>The client would make the switch to the new credentials, and then we remove the
old key pair.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># radosgw-admin key rm --uid='user2' --access-key=S3user2
{
    "user_id": "user2",
    "display_name": "Second User",
    "email": "",
    "suspended": 0,
    "max_buckets": 1000,
    "subusers": [],
    "keys": [
        {
            "user": "user2",
            "access_key": "B7WGSZ1PMMA4RHHVMWK5",
            "secret_key": "S3SECRETKEYNEW"
        }
    ],
    "swift_keys": [],
    "caps": [],
    "op_mask": "read, write, delete",
    "default_placement": "",
    "default_storage_class": "",
    "placement_tags": [],
    "bucket_quota": {
        "enabled": false,
        "check_on_raw": false,
        "max_size": -1,
        "max_size_kb": 0,
        "max_objects": -1
    },
    "user_quota": {
        "enabled": false,
        "check_on_raw": false,
        "max_size": -1,
        "max_size_kb": 0,
        "max_objects": -1
    },
    "temp_url_keys": [],
    "type": "rgw",
    "mfa_ids": []
}</pre>
</div>
</div>
<div class="paragraph">
<p>Users can be easily enabled or disabled with the <code>radosgw-admin user</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[root@ceph-node01 ~]# radosgw-admin user suspend --uid='user2'
{
    "user_id": "user2",
    "display_name": "Second User",
    "email": "",
    "suspended": 1,
    "max_buckets": 1000,
    "subusers": [],
    "keys": [
        {
            "user": "user2",
            "access_key": "B7WGSZ1PMMA4RHHVMWK5",
            "secret_key": "S3SECRETKEYNEW"
        }
    ],
    "swift_keys": [],
    "caps": [],
    "op_mask": "read, write, delete",
    "default_placement": "",
    "default_storage_class": "",
    "placement_tags": [],
    "bucket_quota": {
        "enabled": false,
        "check_on_raw": false,
        "max_size": -1,
        "max_size_kb": 0,
        "max_objects": -1
    },
    "user_quota": {
        "enabled": false,
        "check_on_raw": false,
        "max_size": -1,
        "max_size_kb": 0,
        "max_objects": -1
    },
    "temp_url_keys": [],
    "type": "rgw",
    "mfa_ids": []
}

# radosgw-admin user info --uid='user2' | grep suspend
    "suspended": 1,

# radosgw-admin user enable --uid='user2'

# radosgw-admin user info --uid='user2' | grep suspend
    "suspended": 0,</pre>
</div>
</div>
<div class="paragraph">
<p>The Ceph Storage Cluster provides an administrative API that enables users to execute administrative functions via the REST API. By default, users do NOT have access to this API. To enable a user to exercise administrative functionality, provide the user with administrative capabilities.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>radosgw-admin caps add --uid=user2 --caps="users=*;buckets=*"</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
`--caps="[users|buckets|metadata|usage|zone|amz-cache|info|bilog|mdlog|datalog|user-policy|oidc-provider|roles|ratelimit]=[*|read|write|read,write]" `
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To remove a user and also delete their objects and buckets, use the --purge-data option.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># radosgw-admin user rm --uid=user2 --purge-data</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_multi_tenancy"><a class="anchor" href="#_multi_tenancy"></a>2. Multi-tenancy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Traditionally, if multi-tenancy is not used, S3 bucket names should be “globally” unique With multi-tenancy, each user and bucket lies under a tenant
Prevents namespace clashing when multiple tenants are using common bucket names</p>
</div>
<div class="paragraph">
<p>Create a user testx$tester to be accessed with S3:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># radosgw-admin --tenant testx --uid tester --display-name "Test User" --access_key TESTER --secret test123 user create
{
    "user_id": "testx$tester",
    "display_name": "Test User",
    "email": "",
    "suspended": 0,
    "max_buckets": 1000,
    "subusers": [],
    "keys": [
        {
            "user": "testx$tester",
            "access_key": "TESTER",
            "secret_key": "test123"
        }
    ],
    "swift_keys": [],
    "caps": [],
    "op_mask": "read, write, delete",
    "default_placement": "",
    "default_storage_class": "",
    "placement_tags": [],
    "bucket_quota": {
        "enabled": false,
        "check_on_raw": false,
        "max_size": -1,
        "max_size_kb": 0,
        "max_objects": -1
    },
    "user_quota": {
        "enabled": false,
        "check_on_raw": false,
        "max_size": -1,
        "max_size_kb": 0,
        "max_objects": -1
    },
    "temp_url_keys": [],
    "type": "rgw",
    "mfa_ids": []
}</pre>
</div>
</div>
<div class="paragraph">
<p>If I create a bucket with this user credentials, we can see that it&#8217;s created
as part of tenant: <code>tenantx</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ aws --profile tester s3 --endpoint=http://s3zone1.example.com mb s3://butent --region us-east-1
make_bucket: butent

# radosgw-admin bucket list
[
    "testx/butent"
]

# radosgw-admin bucket stats --bucket 'testx/butent'
{
    "bucket": "butent",
    "num_shards": 11,
    "tenant": "testx",</pre>
</div>
</div>
<div class="paragraph">
<p>Accessing buckets with explicit tenants, Python Boto3 example</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  from boto.s3.connection import S3Connection, OrdinaryCallingFormat
     c = S3Connection(
             aws_access_key_id="TESTER",
             aws_secret_access_key="test123",
             host="ep.host.dom",
             calling_format = OrdinaryCallingFormat())
     bucket = c.get_bucket("testx:butent")</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_quotas"><a class="anchor" href="#_quotas"></a>3. Quotas</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Set quotas to limit the amount of storage a user or bucket can consume. Set the quota parameters
first, then enable the quota. To disable a quota, set a negative value for the quota parameter.
Bucket quotas apply to all buckets owned by a specific UUID, regardless of the user accessing or
uploading to those buckets.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Limit a maximum number of objects</p>
</li>
<li>
<p>Limit a maximum storage size in megabytes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Quotas Can be Applied to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Users</p>
</li>
<li>
<p>Buckets</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Quota Usage example, setting enabling the <code>user_quota</code>, note that the same can be done at the bucket level with <code>bucket_quota</code></p>
</div>
<div class="paragraph">
<p>1.Create a user.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># USER_ACCESS_KEY=$(cat /dev/urandom | tr -dc 'a-zA-Z0-9' | fold -w 20 | head -n 1)
# USER_SECRET_KEY=$(cat /dev/urandom | tr -dc 'a-zA-Z0-9' | fold -w 40 | head -n 1)
# radosgw-admin user create --uid=quota_user --display-name="Qouta user" --access-key=${USER_ACCESS_KEY} --secret=${USER_SECRET_KEY}</pre>
</div>
</div>
<div class="paragraph">
<p>2.Set the quotas for that user.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># radosgw-admin quota set --quota-scope=user --uid=quota_user --max-size=51200 --max-objects=2
# radosgw-admin quota enable --quota-scope=user --uid=quota_user
# radosgw-admin user info --uid=quota_user
"user_quota": {
	"enabled": true,
	"check_on_raw": false,
	"max_size": 51200,
	"max_size_kb": 50,
	"max_objects": 2
},</pre>
</div>
</div>
<div class="paragraph">
<p>3.With the AWS client, as the quota_user, try to go over the limits established by the RadosGW admin user:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># for object in {1..5}; do aws --profile quota_user s3 --endpoint=http://s3zone1.example.com rm  s3://quota/$object ; done
upload: ../etc/hosts to s3://quota/1
upload: ../etc/hosts to s3://quota/2
upload: ../etc/hosts to s3://quota/3
upload failed: ../etc/hosts to s3://quota/4 An error occurred (QuotaExceeded) when calling the PutObject operation: Unknown
upload failed: ../etc/hosts to s3://quota/5 An error occurred (QuotaExceeded) when calling the PutObject operation: Unknown</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Quota may take some time to get enforced until the user usage stats get updated, allowing to slightly go over the specified limits</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <a class="navbar-item" href="https://www.redhat.com/en/technologies/cloud-computing/openshift-container-storage" target="_blank">
      <img src="../../_/img/header_logo.svg" alt="Ceph">
  </a>
</footer>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
